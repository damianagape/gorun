image: damianagape/gorun-devcontainer:0.7.104
definitions:
  caches:
    apps-tfmod-test-0: projects/apps/terraform-modules/test/.terraform
    core-tfmod-main-0: projects/core/terraform-modules/main/.terraform
    core-tfmod-prod-0: projects/core/terraform-modules/prod/.terraform
    core-tfmod-test-0: projects/core/terraform-modules/test/.terraform
    core-tfsub-gcp-docker-images-registry-0: projects/core/terraform-submodules/gcp-docker-images-registry/.terraform
    core-tfsub-gcp-docker-images-registry-1: projects/core/terraform-submodules/gcp-docker-images-registry/.terraform.lock.hcl
    core-tfsub-gcp-helm-charts-registry-0: projects/core/terraform-submodules/gcp-helm-charts-registry/.terraform
    core-tfsub-gcp-helm-charts-registry-1: projects/core/terraform-submodules/gcp-helm-charts-registry/.terraform.lock.hcl
    core-tfsub-gcp-project-0: projects/core/terraform-submodules/gcp-project/.terraform
    core-tfsub-gcp-project-1: projects/core/terraform-submodules/gcp-project/.terraform.lock.hcl
    core-tfsub-gcp-terraform-modules-registry-0: projects/core/terraform-submodules/gcp-terraform-modules-registry/.terraform
    core-tfsub-gcp-terraform-modules-registry-1: projects/core/terraform-submodules/gcp-terraform-modules-registry/.terraform.lock.hcl
    core-tfsub-gcp-terraform-state-bucket-0: projects/core/terraform-submodules/gcp-terraform-state-bucket/.terraform
    core-tfsub-gcp-terraform-state-bucket-1: projects/core/terraform-submodules/gcp-terraform-state-bucket/.terraform.lock.hcl
    core-tfsub-gke-platform-0: projects/core/terraform-submodules/gke-platform/.terraform
    core-tfsub-gke-platform-1: projects/core/terraform-submodules/gke-platform/.terraform.lock.hcl
    core-tfsub-gke-service-account-0: projects/core/terraform-submodules/gke-service-account/.terraform
    core-tfsub-gke-service-account-1: projects/core/terraform-submodules/gke-service-account/.terraform.lock.hcl
    core-tfsub-k8s-gateway-domain-redirect-0: projects/core/terraform-submodules/k8s-gateway-domain-redirect/.terraform
    core-tfsub-k8s-gateway-domain-redirect-1: projects/core/terraform-submodules/k8s-gateway-domain-redirect/.terraform.lock.hcl
    core-tfsub-k8s-gateway-http-route-0: projects/core/terraform-submodules/k8s-gateway-http-route/.terraform
    core-tfsub-k8s-gateway-http-route-1: projects/core/terraform-submodules/k8s-gateway-http-route/.terraform.lock.hcl
    core-tfsub-k8s-vault-0: projects/core/terraform-submodules/k8s-vault/.terraform
    core-tfsub-k8s-vault-1: projects/core/terraform-submodules/k8s-vault/.terraform.lock.hcl
    core-tfsub-k8s-workspace-0: projects/core/terraform-submodules/k8s-workspace/.terraform
    core-tfsub-k8s-workspace-1: projects/core/terraform-submodules/k8s-workspace/.terraform.lock.hcl
    demo-tfmod-kuard-0: projects/demo/terraform-modules/kuard/.terraform
    demo-tfsub-helm-manifest-0: projects/demo/terraform-submodules/helm-manifest/.terraform
    demo-tfsub-helm-manifest-1: projects/demo/terraform-submodules/helm-manifest/.terraform.lock.hcl
    demo-tfsub-helm-template-0: projects/demo/terraform-submodules/helm-template/.terraform
    demo-tfsub-helm-template-1: projects/demo/terraform-submodules/helm-template/.terraform.lock.hcl
    demo-tfsub-kuard-0: projects/demo/terraform-submodules/kuard/.terraform
    demo-tfsub-kuard-1: projects/demo/terraform-submodules/kuard/.terraform.lock.hcl
    o11y-tfmod-test-0: projects/o11y/terraform-modules/test/.terraform
    o11y-tfsub-gcp-availability-monitor-0: projects/o11y/terraform-submodules/gcp-availability-monitor/.terraform
    o11y-tfsub-gcp-availability-monitor-1: projects/o11y/terraform-submodules/gcp-availability-monitor/.terraform.lock.hcl
    o11y-tfsub-gke-observability-stack-0: projects/o11y/terraform-submodules/gke-observability-stack/.terraform
    o11y-tfsub-gke-observability-stack-1: projects/o11y/terraform-submodules/gke-observability-stack/.terraform.lock.hcl
  scripts:
    - &auth |
      set -e
      echo "$GOOGLE_CREDENTIALS" | gcloud auth activate-service-account --key-file="/dev/stdin"
      export GOOGLE_APPLICATION_CREDENTIALS="/tmp/GOOGLE_APPLICATION_CREDENTIALS.json" && echo "$GOOGLE_CREDENTIALS" >"$GOOGLE_APPLICATION_CREDENTIALS"
      gcloud auth configure-docker "europe-central2-docker.pkg.dev"
      gcloud auth print-access-token | helm registry login --username="oauth2accesstoken" --password-stdin "europe-central2-docker.pkg.dev"
  steps:
    - step: &test-apps-chart-http-server
        name: test apps-chart-http-server
        condition:
          changesets:
            includePaths:
              - "projects/apps/helm-charts/http-server/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/apps/helm-charts/http-server"
          - ./scripts/helm-chart test "projects/apps/helm-charts/http-server"
          - ./scripts/helm-chart pre-publish "projects/apps/helm-charts/http-server"
          - ./scripts/helm-chart show "projects/apps/helm-charts/http-server"
    - step: &publish-apps-chart-http-server
        name: publish apps-chart-http-server
        condition:
          changesets:
            includePaths:
              - "projects/apps/helm-charts/http-server/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/apps/helm-charts/http-server"
          - ./scripts/helm-chart test "projects/apps/helm-charts/http-server"
          - ./scripts/helm-chart publish "projects/apps/helm-charts/http-server"
          - ./scripts/helm-chart show "projects/apps/helm-charts/http-server"
    - step: &test-apps-tfmod-test
        name: test apps-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/apps/terraform-modules/test/**"
        caches:
          - apps-tfmod-test-0
        script:
          - *auth
          - ./scripts/terraform-module test "projects/apps/terraform-modules/test"
    - step: &plan-apps-tfmod-test
        name: plan apps-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/apps/terraform-modules/test/**"
        caches:
          - apps-tfmod-test-0
        script:
          - *auth
          - terraform -chdir="projects/apps/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/apps/terraform-modules/test" plan -input="false"
    - step: &apply-apps-tfmod-test
        name: apply apps-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/apps/terraform-modules/test/**"
        caches:
          - apps-tfmod-test-0
        script:
          - *auth
          - terraform -chdir="projects/apps/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/apps/terraform-modules/test" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-core-image-devcontainer
        name: test core-image-devcontainer
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/devcontainer/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image test "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image show "projects/core/docker-images/devcontainer"
    - step: &publish-core-image-devcontainer
        name: publish core-image-devcontainer
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/devcontainer/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image test "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image publish "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image show "projects/core/docker-images/devcontainer"
    - step: &test-core-image-go1-rte
        name: test core-image-go1-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go1-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go1-rte"
          - ./scripts/docker-image test "projects/core/docker-images/go1-rte"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/go1-rte"
          - ./scripts/docker-image show "projects/core/docker-images/go1-rte"
    - step: &publish-core-image-go1-rte
        name: publish core-image-go1-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go1-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go1-rte"
          - ./scripts/docker-image test "projects/core/docker-images/go1-rte"
          - ./scripts/docker-image publish "projects/core/docker-images/go1-rte"
          - ./scripts/docker-image show "projects/core/docker-images/go1-rte"
    - step: &test-core-image-go1-sdk
        name: test core-image-go1-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go1-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go1-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/go1-sdk"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/go1-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/go1-sdk"
    - step: &publish-core-image-go1-sdk
        name: publish core-image-go1-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go1-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go1-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/go1-sdk"
          - ./scripts/docker-image publish "projects/core/docker-images/go1-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/go1-sdk"
    - step: &test-core-image-java21-rte
        name: test core-image-java21-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/java21-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/java21-rte"
          - ./scripts/docker-image test "projects/core/docker-images/java21-rte"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/java21-rte"
          - ./scripts/docker-image show "projects/core/docker-images/java21-rte"
    - step: &publish-core-image-java21-rte
        name: publish core-image-java21-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/java21-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/java21-rte"
          - ./scripts/docker-image test "projects/core/docker-images/java21-rte"
          - ./scripts/docker-image publish "projects/core/docker-images/java21-rte"
          - ./scripts/docker-image show "projects/core/docker-images/java21-rte"
    - step: &test-core-image-java21-sdk
        name: test core-image-java21-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/java21-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/java21-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/java21-sdk"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/java21-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/java21-sdk"
    - step: &publish-core-image-java21-sdk
        name: publish core-image-java21-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/java21-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/java21-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/java21-sdk"
          - ./scripts/docker-image publish "projects/core/docker-images/java21-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/java21-sdk"
    - step: &test-core-image-node24-rte
        name: test core-image-node24-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/node24-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/node24-rte"
          - ./scripts/docker-image test "projects/core/docker-images/node24-rte"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/node24-rte"
          - ./scripts/docker-image show "projects/core/docker-images/node24-rte"
    - step: &publish-core-image-node24-rte
        name: publish core-image-node24-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/node24-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/node24-rte"
          - ./scripts/docker-image test "projects/core/docker-images/node24-rte"
          - ./scripts/docker-image publish "projects/core/docker-images/node24-rte"
          - ./scripts/docker-image show "projects/core/docker-images/node24-rte"
    - step: &test-core-image-node24-sdk
        name: test core-image-node24-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/node24-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/node24-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/node24-sdk"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/node24-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/node24-sdk"
    - step: &publish-core-image-node24-sdk
        name: publish core-image-node24-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/node24-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/node24-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/node24-sdk"
          - ./scripts/docker-image publish "projects/core/docker-images/node24-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/node24-sdk"
    - step: &test-core-chart-clickhouse
        name: test core-chart-clickhouse
        condition:
          changesets:
            includePaths:
              - "projects/core/helm-charts/clickhouse/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/core/helm-charts/clickhouse"
          - ./scripts/helm-chart test "projects/core/helm-charts/clickhouse"
          - ./scripts/helm-chart pre-publish "projects/core/helm-charts/clickhouse"
          - ./scripts/helm-chart show "projects/core/helm-charts/clickhouse"
    - step: &publish-core-chart-clickhouse
        name: publish core-chart-clickhouse
        condition:
          changesets:
            includePaths:
              - "projects/core/helm-charts/clickhouse/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/core/helm-charts/clickhouse"
          - ./scripts/helm-chart test "projects/core/helm-charts/clickhouse"
          - ./scripts/helm-chart publish "projects/core/helm-charts/clickhouse"
          - ./scripts/helm-chart show "projects/core/helm-charts/clickhouse"
    - step: &test-core-chart-configs
        name: test core-chart-configs
        condition:
          changesets:
            includePaths:
              - "projects/core/helm-charts/configs/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/core/helm-charts/configs"
          - ./scripts/helm-chart test "projects/core/helm-charts/configs"
          - ./scripts/helm-chart pre-publish "projects/core/helm-charts/configs"
          - ./scripts/helm-chart show "projects/core/helm-charts/configs"
    - step: &publish-core-chart-configs
        name: publish core-chart-configs
        condition:
          changesets:
            includePaths:
              - "projects/core/helm-charts/configs/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/core/helm-charts/configs"
          - ./scripts/helm-chart test "projects/core/helm-charts/configs"
          - ./scripts/helm-chart publish "projects/core/helm-charts/configs"
          - ./scripts/helm-chart show "projects/core/helm-charts/configs"
    - step: &test-core-chart-postgres
        name: test core-chart-postgres
        condition:
          changesets:
            includePaths:
              - "projects/core/helm-charts/postgres/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/core/helm-charts/postgres"
          - ./scripts/helm-chart test "projects/core/helm-charts/postgres"
          - ./scripts/helm-chart pre-publish "projects/core/helm-charts/postgres"
          - ./scripts/helm-chart show "projects/core/helm-charts/postgres"
    - step: &publish-core-chart-postgres
        name: publish core-chart-postgres
        condition:
          changesets:
            includePaths:
              - "projects/core/helm-charts/postgres/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/core/helm-charts/postgres"
          - ./scripts/helm-chart test "projects/core/helm-charts/postgres"
          - ./scripts/helm-chart publish "projects/core/helm-charts/postgres"
          - ./scripts/helm-chart show "projects/core/helm-charts/postgres"
    - step: &test-core-tfmod-main
        name: test core-tfmod-main
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/main/**"
        caches:
          - core-tfmod-main-0
        script:
          - *auth
          - ./scripts/terraform-module test "projects/core/terraform-modules/main"
    - step: &plan-core-tfmod-main
        name: plan core-tfmod-main
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/main/**"
        caches:
          - core-tfmod-main-0
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/main" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/main" plan -input="false"
    - step: &apply-core-tfmod-main
        name: apply core-tfmod-main
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/main/**"
        caches:
          - core-tfmod-main-0
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/main" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/main" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-core-tfmod-prod
        name: test core-tfmod-prod
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/prod/**"
        caches:
          - core-tfmod-prod-0
        script:
          - *auth
          - ./scripts/terraform-module test "projects/core/terraform-modules/prod"
    - step: &plan-core-tfmod-prod
        name: plan core-tfmod-prod
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/prod/**"
        caches:
          - core-tfmod-prod-0
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/prod" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/prod" plan -input="false"
    - step: &apply-core-tfmod-prod
        name: apply core-tfmod-prod
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/prod/**"
        caches:
          - core-tfmod-prod-0
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/prod" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/prod" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-core-tfmod-test
        name: test core-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/test/**"
        caches:
          - core-tfmod-test-0
        script:
          - *auth
          - ./scripts/terraform-module test "projects/core/terraform-modules/test"
    - step: &plan-core-tfmod-test
        name: plan core-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/test/**"
        caches:
          - core-tfmod-test-0
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/test" plan -input="false"
    - step: &apply-core-tfmod-test
        name: apply core-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/test/**"
        caches:
          - core-tfmod-test-0
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/test" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-core-tfsub-gcp-docker-images-registry
        name: test core-tfsub-gcp-docker-images-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-docker-images-registry/**"
        caches:
          - core-tfsub-gcp-docker-images-registry-0
          - core-tfsub-gcp-docker-images-registry-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-docker-images-registry"
    - step: &publish-core-tfsub-gcp-docker-images-registry
        name: publish core-tfsub-gcp-docker-images-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-docker-images-registry/**"
        caches:
          - core-tfsub-gcp-docker-images-registry-0
          - core-tfsub-gcp-docker-images-registry-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-docker-images-registry"
    - step: &test-core-tfsub-gcp-helm-charts-registry
        name: test core-tfsub-gcp-helm-charts-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-helm-charts-registry/**"
        caches:
          - core-tfsub-gcp-helm-charts-registry-0
          - core-tfsub-gcp-helm-charts-registry-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-helm-charts-registry"
    - step: &publish-core-tfsub-gcp-helm-charts-registry
        name: publish core-tfsub-gcp-helm-charts-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-helm-charts-registry/**"
        caches:
          - core-tfsub-gcp-helm-charts-registry-0
          - core-tfsub-gcp-helm-charts-registry-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-helm-charts-registry"
    - step: &test-core-tfsub-gcp-project
        name: test core-tfsub-gcp-project
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-project/**"
        caches:
          - core-tfsub-gcp-project-0
          - core-tfsub-gcp-project-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-project"
    - step: &publish-core-tfsub-gcp-project
        name: publish core-tfsub-gcp-project
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-project/**"
        caches:
          - core-tfsub-gcp-project-0
          - core-tfsub-gcp-project-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-project"
    - step: &test-core-tfsub-gcp-terraform-modules-registry
        name: test core-tfsub-gcp-terraform-modules-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-modules-registry/**"
        caches:
          - core-tfsub-gcp-terraform-modules-registry-0
          - core-tfsub-gcp-terraform-modules-registry-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-modules-registry"
    - step: &publish-core-tfsub-gcp-terraform-modules-registry
        name: publish core-tfsub-gcp-terraform-modules-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-modules-registry/**"
        caches:
          - core-tfsub-gcp-terraform-modules-registry-0
          - core-tfsub-gcp-terraform-modules-registry-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-modules-registry"
    - step: &test-core-tfsub-gcp-terraform-state-bucket
        name: test core-tfsub-gcp-terraform-state-bucket
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-state-bucket/**"
        caches:
          - core-tfsub-gcp-terraform-state-bucket-0
          - core-tfsub-gcp-terraform-state-bucket-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-state-bucket"
    - step: &publish-core-tfsub-gcp-terraform-state-bucket
        name: publish core-tfsub-gcp-terraform-state-bucket
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-state-bucket/**"
        caches:
          - core-tfsub-gcp-terraform-state-bucket-0
          - core-tfsub-gcp-terraform-state-bucket-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-state-bucket"
    - step: &test-core-tfsub-gke-platform
        name: test core-tfsub-gke-platform
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-platform/**"
        caches:
          - core-tfsub-gke-platform-0
          - core-tfsub-gke-platform-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-platform"
    - step: &publish-core-tfsub-gke-platform
        name: publish core-tfsub-gke-platform
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-platform/**"
        caches:
          - core-tfsub-gke-platform-0
          - core-tfsub-gke-platform-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-platform"
    - step: &test-core-tfsub-gke-service-account
        name: test core-tfsub-gke-service-account
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-service-account/**"
        caches:
          - core-tfsub-gke-service-account-0
          - core-tfsub-gke-service-account-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-service-account"
    - step: &publish-core-tfsub-gke-service-account
        name: publish core-tfsub-gke-service-account
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-service-account/**"
        caches:
          - core-tfsub-gke-service-account-0
          - core-tfsub-gke-service-account-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-service-account"
    - step: &test-core-tfsub-k8s-gateway-domain-redirect
        name: test core-tfsub-k8s-gateway-domain-redirect
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-gateway-domain-redirect/**"
        caches:
          - core-tfsub-k8s-gateway-domain-redirect-0
          - core-tfsub-k8s-gateway-domain-redirect-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
    - step: &publish-core-tfsub-k8s-gateway-domain-redirect
        name: publish core-tfsub-k8s-gateway-domain-redirect
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-gateway-domain-redirect/**"
        caches:
          - core-tfsub-k8s-gateway-domain-redirect-0
          - core-tfsub-k8s-gateway-domain-redirect-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-gateway-domain-redirect"
    - step: &test-core-tfsub-k8s-gateway-http-route
        name: test core-tfsub-k8s-gateway-http-route
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-gateway-http-route/**"
        caches:
          - core-tfsub-k8s-gateway-http-route-0
          - core-tfsub-k8s-gateway-http-route-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-gateway-http-route"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-gateway-http-route"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/k8s-gateway-http-route"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-gateway-http-route"
    - step: &publish-core-tfsub-k8s-gateway-http-route
        name: publish core-tfsub-k8s-gateway-http-route
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-gateway-http-route/**"
        caches:
          - core-tfsub-k8s-gateway-http-route-0
          - core-tfsub-k8s-gateway-http-route-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-gateway-http-route"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-gateway-http-route"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/k8s-gateway-http-route"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-gateway-http-route"
    - step: &test-core-tfsub-k8s-vault
        name: test core-tfsub-k8s-vault
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-vault/**"
        caches:
          - core-tfsub-k8s-vault-0
          - core-tfsub-k8s-vault-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-vault"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-vault"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/k8s-vault"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-vault"
    - step: &publish-core-tfsub-k8s-vault
        name: publish core-tfsub-k8s-vault
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-vault/**"
        caches:
          - core-tfsub-k8s-vault-0
          - core-tfsub-k8s-vault-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-vault"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-vault"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/k8s-vault"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-vault"
    - step: &test-core-tfsub-k8s-workspace
        name: test core-tfsub-k8s-workspace
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-workspace/**"
        caches:
          - core-tfsub-k8s-workspace-0
          - core-tfsub-k8s-workspace-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-workspace"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-workspace"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/k8s-workspace"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-workspace"
    - step: &publish-core-tfsub-k8s-workspace
        name: publish core-tfsub-k8s-workspace
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/k8s-workspace/**"
        caches:
          - core-tfsub-k8s-workspace-0
          - core-tfsub-k8s-workspace-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/k8s-workspace"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/k8s-workspace"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/k8s-workspace"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/k8s-workspace"
    - step: &test-demo-image-kuard
        name: test demo-image-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/docker-images/kuard/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/demo/docker-images/kuard"
          - ./scripts/docker-image test "projects/demo/docker-images/kuard"
          - ./scripts/docker-image pre-publish "projects/demo/docker-images/kuard"
          - ./scripts/docker-image show "projects/demo/docker-images/kuard"
    - step: &publish-demo-image-kuard
        name: publish demo-image-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/docker-images/kuard/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/demo/docker-images/kuard"
          - ./scripts/docker-image test "projects/demo/docker-images/kuard"
          - ./scripts/docker-image publish "projects/demo/docker-images/kuard"
          - ./scripts/docker-image show "projects/demo/docker-images/kuard"
    - step: &test-demo-chart-stateful-kuard
        name: test demo-chart-stateful-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/helm-charts/stateful-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/demo/helm-charts/stateful-kuard"
          - ./scripts/helm-chart test "projects/demo/helm-charts/stateful-kuard"
          - ./scripts/helm-chart pre-publish "projects/demo/helm-charts/stateful-kuard"
          - ./scripts/helm-chart show "projects/demo/helm-charts/stateful-kuard"
    - step: &publish-demo-chart-stateful-kuard
        name: publish demo-chart-stateful-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/helm-charts/stateful-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/demo/helm-charts/stateful-kuard"
          - ./scripts/helm-chart test "projects/demo/helm-charts/stateful-kuard"
          - ./scripts/helm-chart publish "projects/demo/helm-charts/stateful-kuard"
          - ./scripts/helm-chart show "projects/demo/helm-charts/stateful-kuard"
    - step: &test-demo-chart-stateless-kuard
        name: test demo-chart-stateless-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/helm-charts/stateless-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/demo/helm-charts/stateless-kuard"
          - ./scripts/helm-chart test "projects/demo/helm-charts/stateless-kuard"
          - ./scripts/helm-chart pre-publish "projects/demo/helm-charts/stateless-kuard"
          - ./scripts/helm-chart show "projects/demo/helm-charts/stateless-kuard"
    - step: &publish-demo-chart-stateless-kuard
        name: publish demo-chart-stateless-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/helm-charts/stateless-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/demo/helm-charts/stateless-kuard"
          - ./scripts/helm-chart test "projects/demo/helm-charts/stateless-kuard"
          - ./scripts/helm-chart publish "projects/demo/helm-charts/stateless-kuard"
          - ./scripts/helm-chart show "projects/demo/helm-charts/stateless-kuard"
    - step: &test-demo-tfmod-kuard
        name: test demo-tfmod-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-modules/kuard/**"
        caches:
          - demo-tfmod-kuard-0
        script:
          - *auth
          - ./scripts/terraform-module test "projects/demo/terraform-modules/kuard"
    - step: &plan-demo-tfmod-kuard
        name: plan demo-tfmod-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-modules/kuard/**"
        caches:
          - demo-tfmod-kuard-0
        script:
          - *auth
          - terraform -chdir="projects/demo/terraform-modules/kuard" init -input="false"
          - terraform -chdir="projects/demo/terraform-modules/kuard" plan -input="false"
    - step: &apply-demo-tfmod-kuard
        name: apply demo-tfmod-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-modules/kuard/**"
        caches:
          - demo-tfmod-kuard-0
        script:
          - *auth
          - terraform -chdir="projects/demo/terraform-modules/kuard" init -input="false"
          - terraform -chdir="projects/demo/terraform-modules/kuard" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-demo-tfsub-helm-manifest
        name: test demo-tfsub-helm-manifest
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-submodules/helm-manifest/**"
        caches:
          - demo-tfsub-helm-manifest-0
          - demo-tfsub-helm-manifest-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/demo/terraform-submodules/helm-manifest"
          - ./scripts/terraform-submodule test "projects/demo/terraform-submodules/helm-manifest"
          - ./scripts/terraform-submodule pre-publish "projects/demo/terraform-submodules/helm-manifest"
          - ./scripts/terraform-submodule show "projects/demo/terraform-submodules/helm-manifest"
    - step: &publish-demo-tfsub-helm-manifest
        name: publish demo-tfsub-helm-manifest
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-submodules/helm-manifest/**"
        caches:
          - demo-tfsub-helm-manifest-0
          - demo-tfsub-helm-manifest-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/demo/terraform-submodules/helm-manifest"
          - ./scripts/terraform-submodule test "projects/demo/terraform-submodules/helm-manifest"
          - ./scripts/terraform-submodule publish "projects/demo/terraform-submodules/helm-manifest"
          - ./scripts/terraform-submodule show "projects/demo/terraform-submodules/helm-manifest"
    - step: &test-demo-tfsub-helm-template
        name: test demo-tfsub-helm-template
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-submodules/helm-template/**"
        caches:
          - demo-tfsub-helm-template-0
          - demo-tfsub-helm-template-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/demo/terraform-submodules/helm-template"
          - ./scripts/terraform-submodule test "projects/demo/terraform-submodules/helm-template"
          - ./scripts/terraform-submodule pre-publish "projects/demo/terraform-submodules/helm-template"
          - ./scripts/terraform-submodule show "projects/demo/terraform-submodules/helm-template"
    - step: &publish-demo-tfsub-helm-template
        name: publish demo-tfsub-helm-template
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-submodules/helm-template/**"
        caches:
          - demo-tfsub-helm-template-0
          - demo-tfsub-helm-template-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/demo/terraform-submodules/helm-template"
          - ./scripts/terraform-submodule test "projects/demo/terraform-submodules/helm-template"
          - ./scripts/terraform-submodule publish "projects/demo/terraform-submodules/helm-template"
          - ./scripts/terraform-submodule show "projects/demo/terraform-submodules/helm-template"
    - step: &test-demo-tfsub-kuard
        name: test demo-tfsub-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-submodules/kuard/**"
        caches:
          - demo-tfsub-kuard-0
          - demo-tfsub-kuard-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/demo/terraform-submodules/kuard"
          - ./scripts/terraform-submodule test "projects/demo/terraform-submodules/kuard"
          - ./scripts/terraform-submodule pre-publish "projects/demo/terraform-submodules/kuard"
          - ./scripts/terraform-submodule show "projects/demo/terraform-submodules/kuard"
    - step: &publish-demo-tfsub-kuard
        name: publish demo-tfsub-kuard
        condition:
          changesets:
            includePaths:
              - "projects/demo/terraform-submodules/kuard/**"
        caches:
          - demo-tfsub-kuard-0
          - demo-tfsub-kuard-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/demo/terraform-submodules/kuard"
          - ./scripts/terraform-submodule test "projects/demo/terraform-submodules/kuard"
          - ./scripts/terraform-submodule publish "projects/demo/terraform-submodules/kuard"
          - ./scripts/terraform-submodule show "projects/demo/terraform-submodules/kuard"
    - step: &test-o11y-image-grafana
        name: test o11y-image-grafana
        condition:
          changesets:
            includePaths:
              - "projects/o11y/docker-images/grafana/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/o11y/docker-images/grafana"
          - ./scripts/docker-image test "projects/o11y/docker-images/grafana"
          - ./scripts/docker-image pre-publish "projects/o11y/docker-images/grafana"
          - ./scripts/docker-image show "projects/o11y/docker-images/grafana"
    - step: &publish-o11y-image-grafana
        name: publish o11y-image-grafana
        condition:
          changesets:
            includePaths:
              - "projects/o11y/docker-images/grafana/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/o11y/docker-images/grafana"
          - ./scripts/docker-image test "projects/o11y/docker-images/grafana"
          - ./scripts/docker-image publish "projects/o11y/docker-images/grafana"
          - ./scripts/docker-image show "projects/o11y/docker-images/grafana"
    - step: &test-o11y-chart-grafana
        name: test o11y-chart-grafana
        condition:
          changesets:
            includePaths:
              - "projects/o11y/helm-charts/grafana/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/o11y/helm-charts/grafana"
          - ./scripts/helm-chart test "projects/o11y/helm-charts/grafana"
          - ./scripts/helm-chart pre-publish "projects/o11y/helm-charts/grafana"
          - ./scripts/helm-chart show "projects/o11y/helm-charts/grafana"
    - step: &publish-o11y-chart-grafana
        name: publish o11y-chart-grafana
        condition:
          changesets:
            includePaths:
              - "projects/o11y/helm-charts/grafana/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/o11y/helm-charts/grafana"
          - ./scripts/helm-chart test "projects/o11y/helm-charts/grafana"
          - ./scripts/helm-chart publish "projects/o11y/helm-charts/grafana"
          - ./scripts/helm-chart show "projects/o11y/helm-charts/grafana"
    - step: &test-o11y-chart-otelcol
        name: test o11y-chart-otelcol
        condition:
          changesets:
            includePaths:
              - "projects/o11y/helm-charts/otelcol/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/o11y/helm-charts/otelcol"
          - ./scripts/helm-chart test "projects/o11y/helm-charts/otelcol"
          - ./scripts/helm-chart pre-publish "projects/o11y/helm-charts/otelcol"
          - ./scripts/helm-chart show "projects/o11y/helm-charts/otelcol"
    - step: &publish-o11y-chart-otelcol
        name: publish o11y-chart-otelcol
        condition:
          changesets:
            includePaths:
              - "projects/o11y/helm-charts/otelcol/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/o11y/helm-charts/otelcol"
          - ./scripts/helm-chart test "projects/o11y/helm-charts/otelcol"
          - ./scripts/helm-chart publish "projects/o11y/helm-charts/otelcol"
          - ./scripts/helm-chart show "projects/o11y/helm-charts/otelcol"
    - step: &test-o11y-tfmod-test
        name: test o11y-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-modules/test/**"
        caches:
          - o11y-tfmod-test-0
        script:
          - *auth
          - ./scripts/terraform-module test "projects/o11y/terraform-modules/test"
    - step: &plan-o11y-tfmod-test
        name: plan o11y-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-modules/test/**"
        caches:
          - o11y-tfmod-test-0
        script:
          - *auth
          - terraform -chdir="projects/o11y/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/o11y/terraform-modules/test" plan -input="false"
    - step: &apply-o11y-tfmod-test
        name: apply o11y-tfmod-test
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-modules/test/**"
        caches:
          - o11y-tfmod-test-0
        script:
          - *auth
          - terraform -chdir="projects/o11y/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/o11y/terraform-modules/test" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-o11y-tfsub-gcp-availability-monitor
        name: test o11y-tfsub-gcp-availability-monitor
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gcp-availability-monitor/**"
        caches:
          - o11y-tfsub-gcp-availability-monitor-0
          - o11y-tfsub-gcp-availability-monitor-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule pre-publish "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gcp-availability-monitor"
    - step: &publish-o11y-tfsub-gcp-availability-monitor
        name: publish o11y-tfsub-gcp-availability-monitor
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gcp-availability-monitor/**"
        caches:
          - o11y-tfsub-gcp-availability-monitor-0
          - o11y-tfsub-gcp-availability-monitor-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule publish "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gcp-availability-monitor"
    - step: &test-o11y-tfsub-gke-observability-stack
        name: test o11y-tfsub-gke-observability-stack
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gke-observability-stack/**"
        caches:
          - o11y-tfsub-gke-observability-stack-0
          - o11y-tfsub-gke-observability-stack-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gke-observability-stack"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gke-observability-stack"
          - ./scripts/terraform-submodule pre-publish "projects/o11y/terraform-submodules/gke-observability-stack"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gke-observability-stack"
    - step: &publish-o11y-tfsub-gke-observability-stack
        name: publish o11y-tfsub-gke-observability-stack
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gke-observability-stack/**"
        caches:
          - o11y-tfsub-gke-observability-stack-0
          - o11y-tfsub-gke-observability-stack-1
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gke-observability-stack"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gke-observability-stack"
          - ./scripts/terraform-submodule publish "projects/o11y/terraform-submodules/gke-observability-stack"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gke-observability-stack"

pipelines:
  pull-requests:
    main:
      - parallel:
          - step: *test-apps-chart-http-server
          - step: *test-apps-tfmod-test
          - step: *test-core-image-devcontainer
          - step: *test-core-image-go1-rte
          - step: *test-core-image-go1-sdk
          - step: *test-core-image-java21-rte
          - step: *test-core-image-java21-sdk
          - step: *test-core-image-node24-rte
          - step: *test-core-image-node24-sdk
          - step: *test-core-chart-clickhouse
          - step: *test-core-chart-configs
          - step: *test-core-chart-postgres
          - step: *test-core-tfmod-main
          - step: *test-core-tfmod-prod
          - step: *test-core-tfmod-test
          - step: *test-core-tfsub-gcp-docker-images-registry
          - step: *test-core-tfsub-gcp-helm-charts-registry
          - step: *test-core-tfsub-gcp-project
          - step: *test-core-tfsub-gcp-terraform-modules-registry
          - step: *test-core-tfsub-gcp-terraform-state-bucket
          - step: *test-core-tfsub-gke-platform
          - step: *test-core-tfsub-gke-service-account
          - step: *test-core-tfsub-k8s-gateway-domain-redirect
          - step: *test-core-tfsub-k8s-gateway-http-route
          - step: *test-core-tfsub-k8s-vault
          - step: *test-core-tfsub-k8s-workspace
          - step: *test-demo-image-kuard
          - step: *test-demo-chart-stateful-kuard
          - step: *test-demo-chart-stateless-kuard
          - step: *test-demo-tfmod-kuard
          - step: *test-demo-tfsub-helm-manifest
          - step: *test-demo-tfsub-helm-template
          - step: *test-demo-tfsub-kuard
          - step: *test-o11y-image-grafana
          - step: *test-o11y-chart-grafana
          - step: *test-o11y-chart-otelcol
          - step: *test-o11y-tfmod-test
          - step: *test-o11y-tfsub-gcp-availability-monitor
          - step: *test-o11y-tfsub-gke-observability-stack
      - parallel:
          - step: *plan-apps-tfmod-test
          - step: *plan-core-tfmod-main
          - step: *plan-core-tfmod-prod
          - step: *plan-core-tfmod-test
          - step: *plan-demo-tfmod-kuard
          - step: *plan-o11y-tfmod-test
  branches:
    main:
      - parallel:
          - step: *publish-apps-chart-http-server
          - step: *publish-core-image-devcontainer
          - step: *publish-core-image-go1-rte
          - step: *publish-core-image-go1-sdk
          - step: *publish-core-image-java21-rte
          - step: *publish-core-image-java21-sdk
          - step: *publish-core-image-node24-rte
          - step: *publish-core-image-node24-sdk
          - step: *publish-core-chart-clickhouse
          - step: *publish-core-chart-configs
          - step: *publish-core-chart-postgres
          - step: *publish-core-tfsub-gcp-docker-images-registry
          - step: *publish-core-tfsub-gcp-helm-charts-registry
          - step: *publish-core-tfsub-gcp-project
          - step: *publish-core-tfsub-gcp-terraform-modules-registry
          - step: *publish-core-tfsub-gcp-terraform-state-bucket
          - step: *publish-core-tfsub-gke-platform
          - step: *publish-core-tfsub-gke-service-account
          - step: *publish-core-tfsub-k8s-gateway-domain-redirect
          - step: *publish-core-tfsub-k8s-gateway-http-route
          - step: *publish-core-tfsub-k8s-vault
          - step: *publish-core-tfsub-k8s-workspace
          - step: *publish-demo-image-kuard
          - step: *publish-demo-chart-stateful-kuard
          - step: *publish-demo-chart-stateless-kuard
          - step: *publish-demo-tfsub-helm-manifest
          - step: *publish-demo-tfsub-helm-template
          - step: *publish-demo-tfsub-kuard
          - step: *publish-o11y-image-grafana
          - step: *publish-o11y-chart-grafana
          - step: *publish-o11y-chart-otelcol
          - step: *publish-o11y-tfsub-gcp-availability-monitor
          - step: *publish-o11y-tfsub-gke-observability-stack
      - parallel:
          - step: *plan-apps-tfmod-test
          - step: *plan-core-tfmod-main
          - step: *plan-core-tfmod-prod
          - step: *plan-core-tfmod-test
          - step: *plan-demo-tfmod-kuard
          - step: *plan-o11y-tfmod-test
      - parallel:
          - step: *apply-apps-tfmod-test
          - step: *apply-core-tfmod-main
          - step: *apply-core-tfmod-prod
          - step: *apply-core-tfmod-test
          - step: *apply-demo-tfmod-kuard
          - step: *apply-o11y-tfmod-test
